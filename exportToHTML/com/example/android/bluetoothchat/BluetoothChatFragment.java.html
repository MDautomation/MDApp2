<html>
<head>
<title>BluetoothChatFragment.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(204,120,50); }
.s3 { color: rgb(98,151,85); }
.s4 { color: rgb(106,135,89); }
.s5 { color: rgb(128,128,128); }
.s6 { color: rgb(104,151,187); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
BluetoothChatFragment.java</FONT>
</center></TD></TR></TABLE>
<pre>

<span class="s0">/* 
 * Copyright (C) 2014 The Android Open Source Project 
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at 
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0 
 * 
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 * See the License for the specific language governing permissions and 
 * limitations under the License. 
 */</span><span class="s1"> 
 
</span><span class="s2">package </span><span class="s1">com.example.android.bluetoothchat</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">android.app.ActionBar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.app.Activity</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.bluetooth.BluetoothAdapter</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.bluetooth.BluetoothDevice</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.content.Intent</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.os.Bundle</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.os.Handler</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.os.Message</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">java.util.Calendar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.RadioButton</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.Switch</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.ToggleButton</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.CheckBox</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.content.Context</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.app.DatePickerDialog</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.app.TimePickerDialog</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.CompoundButton</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.View.OnClickListener</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.Button</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.DatePicker</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.EditText</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.TimePicker</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.support.annotation.Nullable</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.support.v4.app.Fragment</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.support.v4.app.FragmentActivity</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.KeyEvent</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.LayoutInflater</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.TimePicker</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">android.widget.SeekBar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.Menu</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.MenuInflater</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.MenuItem</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.View</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.ViewGroup</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.inputmethod.EditorInfo</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.ArrayAdapter</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.app.ActionBar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.Button</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.EditText</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.MenuItem</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.ListView</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.Spinner</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.Window</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.view.WindowManager</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.AdapterView.OnItemClickListener</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.AdapterView</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.ListView</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.SeekBar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.TabHost</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.TextView</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">java.util.ArrayList</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">java.util.List</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.SeekBar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.TextView</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.Toast</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">com.example.android.common.logger.Log</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s3">/** 
 * This fragment controls Bluetooth to communicate with other devices. 
 */</span><span class="s1"> 
</span><span class="s2">public class </span><span class="s1">BluetoothChatFragment </span><span class="s2">extends </span><span class="s1">Fragment </span><span class="s2">implements </span><span class="s1">SeekBar.OnSeekBarChangeListener { 
 
    </span><span class="s2">private static final </span><span class="s1">String TAG = </span><span class="s4">&quot;BluetoothChatFragment&quot;</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">Spinner spinner1</span><span class="s2">, </span><span class="s1">schedspin</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">Button btnSubmit</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s5">// Intent request codes</span><span class="s1"> 
    </span><span class="s2">private static final int </span><span class="s1">REQUEST_CONNECT_DEVICE_SECURE = </span><span class="s6">1</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private static final int </span><span class="s1">REQUEST_CONNECT_DEVICE_INSECURE = </span><span class="s6">2</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private static final int </span><span class="s1">REQUEST_ENABLE_BT = </span><span class="s6">3</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">Switch switch1</span><span class="s2">, </span><span class="s1">switch2</span><span class="s2">, </span><span class="s1">switch3</span><span class="s2">, </span><span class="s1">switch4</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private boolean </span><span class="s1">issw1checked</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">int </span><span class="s1">set =</span><span class="s6">40</span><span class="s2">;</span><span class="s1"> 
    SeekBar sb1</span><span class="s2">, </span><span class="s1">sb2</span><span class="s2">, </span><span class="s1">sb3</span><span class="s2">, </span><span class="s1">sb4</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private int </span><span class="s1">bs1</span><span class="s2">, </span><span class="s1">bs2</span><span class="s2">, </span><span class="s1">bs3</span><span class="s2">, </span><span class="s1">bs4</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private int </span><span class="s1">sw1</span><span class="s2">, </span><span class="s1">sw2</span><span class="s2">, </span><span class="s1">sw3</span><span class="s2">, </span><span class="s1">sw4</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">TextView textView</span><span class="s2">, </span><span class="s1">textView2</span><span class="s2">,</span><span class="s1">textView3</span><span class="s2">,</span><span class="s1">textView4</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String message</span><span class="s2">, </span><span class="s1">message1</span><span class="s2">, </span><span class="s1">message2</span><span class="s2">, </span><span class="s1">message3</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">TimePicker tpicker</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">ListView mConversationView</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">EditText mOutEditText</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private int </span><span class="s1">hour</span><span class="s2">, </span><span class="s1">minutes</span><span class="s2">;</span><span class="s1"> 
   </span><span class="s5">// private Button mSendButton;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">Button sync</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">EditText r1</span><span class="s2">, </span><span class="s1">r2</span><span class="s2">, </span><span class="s1">r3</span><span class="s2">, </span><span class="s1">r4</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String newVar</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String newVar1</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String newVar2</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String newVar3</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String mConnectedDeviceName = </span><span class="s2">null;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String Days</span><span class="s2">, </span><span class="s1">Sched</span><span class="s2">, </span><span class="s1">day</span><span class="s2">, </span><span class="s1">sche</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">ArrayAdapter&lt;String&gt; mConversationArrayAdapter</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String hourz</span><span class="s2">, </span><span class="s1">minutez</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">StringBuffer mOutStringBuffer</span><span class="s2">;</span><span class="s1"> 
 
    </span><span class="s2">private </span><span class="s1">BluetoothAdapter mBluetoothAdapter = </span><span class="s2">null;</span><span class="s1"> 
 
    </span><span class="s2">private </span><span class="s1">BluetoothChatService mChatService = </span><span class="s2">null;</span><span class="s1"> 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onCreate(Bundle savedInstanceState) { 
        </span><span class="s2">super</span><span class="s1">.onCreate(savedInstanceState)</span><span class="s2">;</span><span class="s1"> 
        setHasOptionsMenu(</span><span class="s2">true</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s5">// Get local Bluetooth adapter</span><span class="s1"> 
        mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter()</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s5">// If the adapter is null, then Bluetooth is not supported</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(mBluetoothAdapter == </span><span class="s2">null</span><span class="s1">) { 
            FragmentActivity activity = getActivity()</span><span class="s2">;</span><span class="s1"> 
            Toast.makeText(activity</span><span class="s2">, </span><span class="s4">&quot;Bluetooth is not available&quot;</span><span class="s2">, </span><span class="s1">Toast.LENGTH_LONG).show()</span><span class="s2">;</span><span class="s1"> 
            activity.finish()</span><span class="s2">;</span><span class="s1"> 
        } 
    } 
 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onStart() { 
        </span><span class="s2">super</span><span class="s1">.onStart()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s5">// If BT is not on, request that it be enabled.</span><span class="s1"> 
        </span><span class="s5">// setupChat() will then be called during onActivityResult</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(!mBluetoothAdapter.isEnabled()) { 
            Intent enableIntent = </span><span class="s2">new </span><span class="s1">Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE)</span><span class="s2">;</span><span class="s1"> 
            startActivityForResult(enableIntent</span><span class="s2">, </span><span class="s1">REQUEST_ENABLE_BT)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s5">// Otherwise, setup the chat session</span><span class="s1"> 
        } </span><span class="s2">else if </span><span class="s1">(mChatService == </span><span class="s2">null</span><span class="s1">) { 
            setupChat()</span><span class="s2">;</span><span class="s1"> 
        } 
        sb1 = (SeekBar) getView().findViewById(R.id.seekBar2)</span><span class="s2">;</span><span class="s1"> 
        sb2 = (SeekBar) getView().findViewById(R.id.seekBar3)</span><span class="s2">;</span><span class="s1"> 
        sb3 = (SeekBar) getView().findViewById(R.id.seekBar4)</span><span class="s2">;</span><span class="s1"> 
        sb4 = (SeekBar) getView().findViewById(R.id.seekBar5)</span><span class="s2">;</span><span class="s1"> 
 
        sb1.setOnSeekBarChangeListener(</span><span class="s2">this</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        sb2.setOnSeekBarChangeListener(</span><span class="s2">this</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        sb3.setOnSeekBarChangeListener(</span><span class="s2">this</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        sb4.setOnSeekBarChangeListener(</span><span class="s2">this</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        ((TextView) getView().findViewById(R.id.editText)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        ((TextView) getView().findViewById(R.id.editText2)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        ((TextView) getView().findViewById(R.id.editText3)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        ((TextView) getView().findViewById(R.id.editText4)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        tpicker =(TimePicker) getView().findViewById(R.id.timePicker)</span><span class="s2">;</span><span class="s1"> 
        hour = tpicker.getCurrentHour()</span><span class="s2">;</span><span class="s1"> 
        minutes = tpicker.getCurrentMinute()</span><span class="s2">;</span><span class="s1"> 
        hourz =Integer.toString(hour)</span><span class="s2">;</span><span class="s1"> 
        minutez =Integer.toString(minutes)</span><span class="s2">;</span><span class="s1"> 
        addListenerOnButton()</span><span class="s2">;</span><span class="s1"> 
        addListenerOnSpinnerItemSelection()</span><span class="s2">;</span><span class="s1"> 
        updatetime()</span><span class="s2">;</span><span class="s1"> 
        updatevalues()</span><span class="s2">;</span><span class="s1"> 
 
    } 
    </span><span class="s2">public void </span><span class="s1">addListenerOnSpinnerItemSelection() { 
 
        schedspin = (Spinner) getView().findViewById(R.id.schedspin)</span><span class="s2">;</span><span class="s1"> 
 
        schedspin.setOnItemSelectedListener(</span><span class="s2">new </span><span class="s1">CustomonItemSelectedListener())</span><span class="s2">;</span><span class="s1"> 
    } 
    </span><span class="s5">// get the selected dropdown list valuedk</span><span class="s1"> 
 
    </span><span class="s2">private void </span><span class="s1">updatevalues() { 
 
        bs1 = sb1.getProgress()</span><span class="s2">;</span><span class="s1"> 
        bs2 = sb2.getProgress()</span><span class="s2">;</span><span class="s1"> 
        bs3 = sb3.getProgress()</span><span class="s2">;</span><span class="s1"> 
        bs4 = sb4.getProgress()</span><span class="s2">;</span><span class="s1"> 
        switch1 = (Switch) getView().findViewById(R.id.switch1)</span><span class="s2">;</span><span class="s1"> 
        switch2 = (Switch) getView().findViewById(R.id.switch2)</span><span class="s2">;</span><span class="s1"> 
        switch3 = (Switch) getView().findViewById(R.id.switch3)</span><span class="s2">;</span><span class="s1"> 
        switch4 = (Switch) getView().findViewById(R.id.switch4)</span><span class="s2">;</span><span class="s1"> 
        switch1.setOnCheckedChangeListener(</span><span class="s2">new </span><span class="s1">CompoundButton.OnCheckedChangeListener() { 
 
            @Override 
            </span><span class="s2">public void </span><span class="s1">onCheckedChanged(CompoundButton buttonView</span><span class="s2">, boolean </span><span class="s1">isChecked) { 
                </span><span class="s2">if </span><span class="s1">(isChecked){ 
                     sw1 =</span><span class="s6">1</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText)).setText(bs1 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
                </span><span class="s2">else  </span><span class="s1">{ 
                    sw1=</span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
            } 
        })</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">(sw1==</span><span class="s6">1</span><span class="s1">){ 
            ((TextView) getView().findViewById(R.id.editText)).setText(bs1 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">else </span><span class="s1">{ 
            ((TextView) getView().findViewById(R.id.editText)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        switch2.setOnCheckedChangeListener(</span><span class="s2">new </span><span class="s1">CompoundButton.OnCheckedChangeListener() { 
 
            @Override 
            </span><span class="s2">public void </span><span class="s1">onCheckedChanged(CompoundButton buttonView</span><span class="s2">, boolean </span><span class="s1">isChecked) { 
                </span><span class="s2">if </span><span class="s1">(isChecked){ 
                    sw2 =</span><span class="s6">1</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText2)).setText(bs2 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
                </span><span class="s2">else  </span><span class="s1">{ 
                    sw2=</span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText2)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
            } 
        })</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">(sw2==</span><span class="s6">1</span><span class="s1">){ 
            ((TextView) getView().findViewById(R.id.editText2)).setText(bs2 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">else if </span><span class="s1">(sw2==</span><span class="s6">0</span><span class="s1">) { 
            ((TextView) getView().findViewById(R.id.editText2)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        switch3.setOnCheckedChangeListener(</span><span class="s2">new </span><span class="s1">CompoundButton.OnCheckedChangeListener() { 
 
            @Override 
            </span><span class="s2">public void </span><span class="s1">onCheckedChanged(CompoundButton buttonView</span><span class="s2">, boolean </span><span class="s1">isChecked) { 
                </span><span class="s2">if </span><span class="s1">(isChecked){ 
                    sw3 =</span><span class="s6">1</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText3)).setText(bs3 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
                </span><span class="s2">else  </span><span class="s1">{ 
                    sw3=</span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText3)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
            } 
        })</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">(sw3==</span><span class="s6">1</span><span class="s1">){ 
            ((TextView) getView().findViewById(R.id.editText3)).setText(bs3 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">else if </span><span class="s1">(sw3==</span><span class="s6">0</span><span class="s1">) { 
            ((TextView) getView().findViewById(R.id.editText3)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        switch4.setOnCheckedChangeListener(</span><span class="s2">new </span><span class="s1">CompoundButton.OnCheckedChangeListener() { 
 
            @Override 
            </span><span class="s2">public void </span><span class="s1">onCheckedChanged(CompoundButton buttonView</span><span class="s2">, boolean </span><span class="s1">isChecked) { 
                </span><span class="s2">if </span><span class="s1">(isChecked){ 
                    sw4 =</span><span class="s6">1</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText4)).setText(bs4 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
                </span><span class="s2">else  </span><span class="s1">{ 
                    sw4=</span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.editText4)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
            } 
        })</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">(sw4==</span><span class="s6">1</span><span class="s1">){ 
            ((TextView) getView().findViewById(R.id.editText4)).setText(bs4 + </span><span class="s6">40 </span><span class="s1">+ </span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">else if </span><span class="s1">(sw4==</span><span class="s6">0</span><span class="s1">) { 
            ((TextView) getView().findViewById(R.id.editText4)).setText(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
    } 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onProgressChanged(SeekBar seekBar</span><span class="s2">, int </span><span class="s1">progress</span><span class="s2">, boolean </span><span class="s1">fromUser) { 
        updatevalues()</span><span class="s2">;</span><span class="s1"> 
 
    } 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onStartTrackingTouch(SeekBar seekBar) { 
 
    } 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onStopTrackingTouch(SeekBar seekBar) { 
 
    } 
 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onDestroy() { 
        </span><span class="s2">super</span><span class="s1">.onDestroy()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(mChatService != </span><span class="s2">null</span><span class="s1">) { 
            mChatService.stop()</span><span class="s2">;</span><span class="s1"> 
        } 
    } 
 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onResume() { 
        </span><span class="s2">super</span><span class="s1">.onResume()</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s5">// Performing this check in onResume() covers the case in which BT was</span><span class="s1"> 
        </span><span class="s5">// not enabled during onStart(), so we were paused to enable it...</span><span class="s1"> 
        </span><span class="s5">// onResume() will be called when ACTION_REQUEST_ENABLE activity returns.</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(mChatService != </span><span class="s2">null</span><span class="s1">) { 
            </span><span class="s5">// Only if the state is STATE_NONE, do we know that we haven't started already</span><span class="s1"> 
            </span><span class="s2">if </span><span class="s1">(mChatService.getState() == BluetoothChatService.STATE_NONE) { 
                </span><span class="s5">// Start the Bluetooth chat services</span><span class="s1"> 
                mChatService.start()</span><span class="s2">;</span><span class="s1"> 
            } 
        } 
    } 
 
    @Override 
    </span><span class="s2">public </span><span class="s1">View onCreateView(LayoutInflater inflater</span><span class="s2">, </span><span class="s1">@Nullable ViewGroup container</span><span class="s2">,</span><span class="s1"> 
                             @Nullable Bundle savedInstanceState) { 
        </span><span class="s2">return </span><span class="s1">inflater.inflate(R.layout.fragment_bluetooth_chat</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, false</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
    } 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onViewCreated(View view</span><span class="s2">, </span><span class="s1">@Nullable Bundle savedInstanceState) { 
        mConversationView = (ListView) view.findViewById(R.id.in)</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s5">// mOutEditText = (EditText) view.findViewById(R.id.edit_text_out);</span><span class="s1"> 
        r1 = (EditText) view.findViewById(R.id.editText)</span><span class="s2">;</span><span class="s1"> 
        r2 = (EditText) view.findViewById(R.id.editText2)</span><span class="s2">;</span><span class="s1"> 
        r3 = (EditText) view.findViewById(R.id.editText3)</span><span class="s2">;</span><span class="s1"> 
        r4 = (EditText) view.findViewById(R.id.editText4)</span><span class="s2">;</span><span class="s1"> 
 
     </span><span class="s5">//   mSendButton = (Button) view.findViewById(R.id.button_send);</span><span class="s1"> 
      </span><span class="s5">//  save = (Button) view.findViewById(R.id.save);</span><span class="s1"> 
 
    } 
 
    </span><span class="s3">/** 
     * Set up the UI and background operations for chat. 
     */</span><span class="s1"> 
    </span><span class="s2">private void </span><span class="s1">updatetime(){ 
       </span><span class="s5">//method that converts time</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;1&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;01&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;2&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;02&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;3&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;03&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;4&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;04&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;5&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;05&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;6&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;06&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;7&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;07&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;8&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;08&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(hourz.equals(</span><span class="s4">&quot;9&quot;</span><span class="s1">)) { 
            hourz = (</span><span class="s4">&quot;09&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;1&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;01&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;2&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;02&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;3&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;03&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;4&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;04&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;5&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;05&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;6&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;06&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;7&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;07&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;8&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;08&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s2">if </span><span class="s1">(minutez.equals(</span><span class="s4">&quot;9&quot;</span><span class="s1">)) { 
            minutez = (</span><span class="s4">&quot;09&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        } 
    } 
    </span><span class="s2">private void </span><span class="s1">setupChat() { 
        Log.d(TAG</span><span class="s2">, </span><span class="s4">&quot;setupChat()&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s5">// Initialize the array adapter for the conversation thread</span><span class="s1"> 
        mConversationArrayAdapter = </span><span class="s2">new </span><span class="s1">ArrayAdapter&lt;String&gt;(getActivity()</span><span class="s2">, </span><span class="s1">R.layout.message)</span><span class="s2">;</span><span class="s1"> 
        mConversationView.setAdapter(mConversationArrayAdapter)</span><span class="s2">;</span><span class="s1"> 
        mChatService = </span><span class="s2">new </span><span class="s1">BluetoothChatService(getActivity()</span><span class="s2">, </span><span class="s1">mHandler)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s5">// Initialize the buffer for outgoing messages</span><span class="s1"> 
        mOutStringBuffer = </span><span class="s2">new </span><span class="s1">StringBuffer(</span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s2">public void </span><span class="s1">addListenerOnButton() { 
        schedspin = (Spinner) getView().findViewById(R.id.schedspin)</span><span class="s2">;</span><span class="s1"> 
        btnSubmit = (Button) getView().findViewById(R.id.savespin)</span><span class="s2">;</span><span class="s1"> 
        sync = (Button) getView().findViewById(R.id.sync)</span><span class="s2">;</span><span class="s1"> 
        sync.setOnClickListener(</span><span class="s2">new </span><span class="s1">OnClickListener() { 
            @Override 
            </span><span class="s2">public void </span><span class="s1">onClick(View v) { 
                updatetime()</span><span class="s2">;</span><span class="s1"> 
                sendMessage(</span><span class="s4">&quot;U&quot;</span><span class="s1">+hourz+minutez)</span><span class="s2">;</span><span class="s1"> 
 
               </span><span class="s5">// try { Thread.sleep(4000); } catch (Exception e) { return ;}</span><span class="s1"> 
            } 
        })</span><span class="s2">;</span><span class="s1"> 
        btnSubmit.setOnClickListener(</span><span class="s2">new </span><span class="s1">OnClickListener() { 
 
            @Override 
            </span><span class="s2">public void </span><span class="s1">onClick(View v) { 
                textView = (TextView) getView().findViewById(R.id.editText)</span><span class="s2">;</span><span class="s1"> 
                message = textView.getText().toString()</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">if</span><span class="s1">(message.equals(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)){ 
                    message=</span><span class="s4">&quot;xx&quot;</span><span class="s2">;</span><span class="s1"> 
                } 
                textView2 = (TextView) getView().findViewById(R.id.editText2)</span><span class="s2">;</span><span class="s1"> 
                message1 = textView2.getText().toString()</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">if</span><span class="s1">(message1.equals(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)){ 
                    message1=</span><span class="s4">&quot;xx&quot;</span><span class="s2">;</span><span class="s1"> 
                } 
                textView3 = (TextView) getView().findViewById(R.id.editText3)</span><span class="s2">;</span><span class="s1"> 
                message2 = textView3.getText().toString()</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">if</span><span class="s1">(message2.equals(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)){ 
                    message2=</span><span class="s4">&quot;xx&quot;</span><span class="s2">;</span><span class="s1"> 
                } 
                textView4 = (TextView) getView().findViewById(R.id.editText4)</span><span class="s2">;</span><span class="s1"> 
                message3 = textView4.getText().toString()</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">if</span><span class="s1">(message3.equals(</span><span class="s4">&quot;nl&quot;</span><span class="s1">)){ 
                    message3=</span><span class="s4">&quot;xx&quot;</span><span class="s2">;</span><span class="s1"> 
                } 
                hour = tpicker.getCurrentHour()</span><span class="s2">;</span><span class="s1"> 
                minutes = tpicker.getCurrentMinute()</span><span class="s2">;</span><span class="s1"> 
                Sched = String.valueOf(schedspin.getSelectedItem())</span><span class="s2">;</span><span class="s1"> 
                tpicker =(TimePicker) getView().findViewById(R.id.timePicker)</span><span class="s2">;</span><span class="s1"> 
                hour = tpicker.getCurrentHour()</span><span class="s2">;</span><span class="s1"> 
                minutes = tpicker.getCurrentMinute()</span><span class="s2">;</span><span class="s1"> 
                hourz =Integer.toString(hour)</span><span class="s2">;</span><span class="s1"> 
                minutez =Integer.toString(minutes)</span><span class="s2">;</span><span class="s1"> 
                addListenerOnButton()</span><span class="s2">;</span><span class="s1"> 
                addListenerOnSpinnerItemSelection()</span><span class="s2">;</span><span class="s1"> 
                updatetime()</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">char </span><span class="s1">c= Sched.charAt(</span><span class="s6">15</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">if</span><span class="s1">(c==</span><span class="s4">'y'</span><span class="s1">){ 
                    hourz=</span><span class="s4">&quot;xx&quot;</span><span class="s2">;</span><span class="s1"> 
                    minutez=</span><span class="s4">&quot;xx&quot;</span><span class="s2">;</span><span class="s1"> 
                } 
                ((TextView) getView().findViewById(R.id.spintext)).setText(</span><span class="s4">&quot;z&quot;</span><span class="s1">+message+message1+message2+message3+c+hourz+minutez)</span><span class="s2">;</span><span class="s1"> 
               </span><span class="s5">// sendMessage(&quot;z&quot;+message+message1+message2+message3+c+hourz+minutez);</span><span class="s1"> 
                sendMessage(</span><span class="s4">&quot;c74727274n404040400600w404040402200&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">try </span><span class="s1">{ Thread.sleep(</span><span class="s6">4000</span><span class="s1">)</span><span class="s2">; </span><span class="s1">} </span><span class="s2">catch </span><span class="s1">(Exception e) { </span><span class="s2">return ;</span><span class="s1">} 
            } 
        })</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s2">private void </span><span class="s1">ensureDiscoverable() { 
        </span><span class="s2">if </span><span class="s1">(mBluetoothAdapter.getScanMode() != 
                BluetoothAdapter.SCAN_MODE_CONNECTABLE_DISCOVERABLE) { 
            Intent discoverableIntent = </span><span class="s2">new </span><span class="s1">Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE)</span><span class="s2">;</span><span class="s1"> 
            discoverableIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION</span><span class="s2">, </span><span class="s6">300</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
            startActivity(discoverableIntent)</span><span class="s2">;</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s3">/** 
     * Sends a message. 
     * 
     * @param message A string of text to send. 
     */</span><span class="s1"> 
    </span><span class="s2">private void </span><span class="s1">sendMessage(String message) { 
        </span><span class="s5">// Check that we're actually connected before trying anything</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(mChatService.getState() != BluetoothChatService.STATE_CONNECTED) { 
            Toast.makeText(getActivity()</span><span class="s2">, </span><span class="s1">R.string.not_connected</span><span class="s2">, </span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s2">return;</span><span class="s1"> 
        } 
 
        </span><span class="s5">// Check that there's actually something to send</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(message.length() &gt; </span><span class="s6">0</span><span class="s1">) { 
            </span><span class="s5">// Get the message bytes and tell the BluetoothChatService to write</span><span class="s1"> 
            </span><span class="s2">byte</span><span class="s1">[] send = message.getBytes()</span><span class="s2">;</span><span class="s1"> 
            mChatService.write(send)</span><span class="s2">;</span><span class="s1"> 
 
            </span><span class="s5">// Reset out string buffer to zero and clear the edit text field</span><span class="s1"> 
            mOutStringBuffer.setLength(</span><span class="s6">0</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
           </span><span class="s5">// mOutEditText.setText(mOutStringBuffer);</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s3">/** 
     * The action listener for the EditText widget, to listen for the return key 
     */</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">TextView.OnEditorActionListener mWriteListener 
            = </span><span class="s2">new </span><span class="s1">TextView.OnEditorActionListener() { 
        </span><span class="s2">public boolean </span><span class="s1">onEditorAction(TextView view</span><span class="s2">, int </span><span class="s1">actionId</span><span class="s2">, </span><span class="s1">KeyEvent event) { 
            </span><span class="s5">// If the action is a key-up event on the return key, send the message</span><span class="s1"> 
            </span><span class="s2">if </span><span class="s1">(actionId == EditorInfo.IME_NULL &amp;&amp; event.getAction() == KeyEvent.ACTION_UP) { 
                String message = view.getText().toString()</span><span class="s2">;</span><span class="s1"> 
                sendMessage(message)</span><span class="s2">;</span><span class="s1"> 
            } 
            </span><span class="s2">return true;</span><span class="s1"> 
        } 
    }</span><span class="s2">;</span><span class="s1"> 
 
    </span><span class="s3">/** 
     * Updates the status on the action bar. 
     * 
     * @param resId a string resource ID 
     */</span><span class="s1"> 
    </span><span class="s2">private void </span><span class="s1">setStatus(</span><span class="s2">int </span><span class="s1">resId) { 
        FragmentActivity activity = getActivity()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(</span><span class="s2">null </span><span class="s1">== activity) { 
            </span><span class="s2">return;</span><span class="s1"> 
        } 
        </span><span class="s2">final </span><span class="s1">ActionBar actionBar = activity.getActionBar()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(</span><span class="s2">null </span><span class="s1">== actionBar) { 
            </span><span class="s2">return;</span><span class="s1"> 
        } 
        actionBar.setSubtitle(resId)</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s3">/** 
     * Updates the status on the action bar. 
     * 
     * @param subTitle status.l 
     */</span><span class="s1"> 
    </span><span class="s2">private void </span><span class="s1">setStatus(CharSequence subTitle) { 
        FragmentActivity activity = getActivity()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(</span><span class="s2">null </span><span class="s1">== activity) { 
            </span><span class="s2">return;</span><span class="s1"> 
        } 
        </span><span class="s2">final </span><span class="s1">ActionBar actionBar = activity.getActionBar()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">(</span><span class="s2">null </span><span class="s1">== actionBar) { 
            </span><span class="s2">return;</span><span class="s1"> 
        } 
        actionBar.setSubtitle(subTitle)</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s3">/** 
     * The Handler that gets information back from the BluetoothChatService 
     */</span><span class="s1"> 
    </span><span class="s2">private final </span><span class="s1">Handler mHandler = </span><span class="s2">new </span><span class="s1">Handler() { 
        @Override 
        </span><span class="s2">public void </span><span class="s1">handleMessage(Message msg) { 
            FragmentActivity activity = getActivity()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s2">switch </span><span class="s1">(msg.what) { 
                </span><span class="s2">case </span><span class="s1">Constants.MESSAGE_STATE_CHANGE: 
                    </span><span class="s2">switch </span><span class="s1">(msg.arg1) { 
                        </span><span class="s2">case </span><span class="s1">BluetoothChatService.STATE_CONNECTED: 
                            setStatus(getString(R.string.title_connected_to</span><span class="s2">, </span><span class="s1">mConnectedDeviceName))</span><span class="s2">;</span><span class="s1"> 
                            mConversationArrayAdapter.clear()</span><span class="s2">;</span><span class="s1"> 
 
                            </span><span class="s2">break;</span><span class="s1"> 
                        </span><span class="s2">case </span><span class="s1">BluetoothChatService.STATE_CONNECTING: 
                            setStatus(R.string.title_connecting)</span><span class="s2">;</span><span class="s1"> 
                            </span><span class="s2">break;</span><span class="s1"> 
                        </span><span class="s2">case </span><span class="s1">BluetoothChatService.STATE_LISTEN: 
                        </span><span class="s2">case </span><span class="s1">BluetoothChatService.STATE_NONE: 
                            setStatus(R.string.title_not_connected)</span><span class="s2">;</span><span class="s1"> 
                            </span><span class="s2">break;</span><span class="s1"> 
                    } 
                    </span><span class="s2">break;</span><span class="s1"> 
                </span><span class="s2">case </span><span class="s1">Constants.MESSAGE_WRITE: 
                    </span><span class="s2">byte</span><span class="s1">[] writeBuf = (</span><span class="s2">byte</span><span class="s1">[]) msg.obj</span><span class="s2">;</span><span class="s1"> 
                    </span><span class="s5">// construct a string from the buffer</span><span class="s1"> 
                    String writeMessage = </span><span class="s2">new </span><span class="s1">String(writeBuf)</span><span class="s2">;</span><span class="s1"> 
                    mConversationArrayAdapter.add(</span><span class="s4">&quot;Me:  &quot; </span><span class="s1">+ writeMessage)</span><span class="s2">;</span><span class="s1"> 
                    </span><span class="s2">break;</span><span class="s1"> 
                </span><span class="s2">case </span><span class="s1">Constants.MESSAGE_READ: 
                    </span><span class="s2">byte</span><span class="s1">[] readBuf = (</span><span class="s2">byte</span><span class="s1">[]) msg.obj</span><span class="s2">;</span><span class="s1"> 
                    </span><span class="s5">// construct a string from the valid bytes in the buffer</span><span class="s1"> 
                    String readMessage = </span><span class="s2">new </span><span class="s1">String(readBuf</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s1">msg.arg1)</span><span class="s2">;</span><span class="s1"> 
                    mConversationArrayAdapter.add(mConnectedDeviceName + </span><span class="s4">&quot;:  &quot; </span><span class="s1">+ readMessage)</span><span class="s2">;</span><span class="s1"> 
 
                    </span><span class="s5">// USE FOR DETERMINING ROOM TEMPERATURES SENT FROM BLUETOOTH TO PHONE</span><span class="s1"> 
 
                       ((TextView) getView().findViewById(R.id.r1temp)).setText(</span><span class="s4">&quot; &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">1</span><span class="s1">)+readMessage.charAt(</span><span class="s6">2</span><span class="s1">)+</span><span class="s4">&quot; &quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                       ((TextView) getView().findViewById(R.id.r2temp)).setText(</span><span class="s4">&quot; &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">3</span><span class="s1">)+readMessage.charAt(</span><span class="s6">4</span><span class="s1">)+</span><span class="s4">&quot; &quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                       ((TextView) getView().findViewById(R.id.r3temp)).setText(</span><span class="s4">&quot; &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">5</span><span class="s1">)+readMessage.charAt(</span><span class="s6">6</span><span class="s1">)+</span><span class="s4">&quot; &quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                       ((TextView) getView().findViewById(R.id.r4temp)).setText(</span><span class="s4">&quot; &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">7</span><span class="s1">)+readMessage.charAt(</span><span class="s6">8</span><span class="s1">)+</span><span class="s4">&quot; &quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                       ((TextView) getView().findViewById(R.id.textView16)).setText(</span><span class="s4">&quot;Room 1: &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">10</span><span class="s1">)+readMessage.charAt(</span><span class="s6">11</span><span class="s1">)+</span><span class="s4">&quot; and &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">23</span><span class="s1">)+readMessage.charAt(</span><span class="s6">24</span><span class="s1">)+</span><span class="s4">&quot; degrees&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.textView2)).setText(</span><span class="s4">&quot;Room 2: &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">12</span><span class="s1">)+readMessage.charAt(</span><span class="s6">13</span><span class="s1">)+</span><span class="s4">&quot; and &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">25</span><span class="s1">)+readMessage.charAt(</span><span class="s6">26</span><span class="s1">)+</span><span class="s4">&quot; degrees&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.textView18)).setText(</span><span class="s4">&quot;Room 3: &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">14</span><span class="s1">)+readMessage.charAt(</span><span class="s6">15</span><span class="s1">)+</span><span class="s4">&quot; and &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">27</span><span class="s1">)+readMessage.charAt(</span><span class="s6">28</span><span class="s1">)+</span><span class="s4">&quot; degrees&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.textView20)).setText(</span><span class="s4">&quot;Room 4: &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">16</span><span class="s1">)+readMessage.charAt(</span><span class="s6">17</span><span class="s1">)+</span><span class="s4">&quot; and &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">29</span><span class="s1">)+readMessage.charAt(</span><span class="s6">30</span><span class="s1">)+</span><span class="s4">&quot; degrees&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                    ((TextView) getView().findViewById(R.id.textView7)).setText(</span><span class="s4">&quot;Scheduled Event Times: &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">18</span><span class="s1">)+readMessage.charAt(</span><span class="s6">19</span><span class="s1">)+</span><span class="s4">&quot;:&quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">20</span><span class="s1">)+readMessage.charAt(</span><span class="s6">21</span><span class="s1">)+</span><span class="s4">&quot; and &quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">31</span><span class="s1">)+readMessage.charAt(</span><span class="s6">32</span><span class="s1">)+</span><span class="s4">&quot;:&quot;</span><span class="s1">+readMessage.charAt(</span><span class="s6">33</span><span class="s1">)+readMessage.charAt(</span><span class="s6">34</span><span class="s1">))</span><span class="s2">;</span><span class="s1"> 
                    </span><span class="s2">break;</span><span class="s1"> 
                </span><span class="s2">case </span><span class="s1">Constants.MESSAGE_DEVICE_NAME: 
                    </span><span class="s5">// save the connected device's name</span><span class="s1"> 
                    mConnectedDeviceName = msg.getData().getString(Constants.DEVICE_NAME)</span><span class="s2">;</span><span class="s1"> 
                    </span><span class="s2">if </span><span class="s1">(</span><span class="s2">null </span><span class="s1">!= activity) { 
                        Toast.makeText(activity</span><span class="s2">, </span><span class="s4">&quot;Connected to &quot;</span><span class="s1"> 
                                + mConnectedDeviceName</span><span class="s2">, </span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
                    } 
                    </span><span class="s2">break;</span><span class="s1"> 
                </span><span class="s2">case </span><span class="s1">Constants.MESSAGE_TOAST: 
                    </span><span class="s2">if </span><span class="s1">(</span><span class="s2">null </span><span class="s1">!= activity) { 
                        Toast.makeText(activity</span><span class="s2">, </span><span class="s1">msg.getData().getString(Constants.TOAST)</span><span class="s2">,</span><span class="s1"> 
                                Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
                    } 
                    </span><span class="s2">break;</span><span class="s1"> 
            } 
        } 
    }</span><span class="s2">;</span><span class="s1"> 
 
    </span><span class="s2">public void </span><span class="s1">onActivityResult(</span><span class="s2">int </span><span class="s1">requestCode</span><span class="s2">, int </span><span class="s1">resultCode</span><span class="s2">, </span><span class="s1">Intent data) { 
        </span><span class="s2">switch </span><span class="s1">(requestCode) { 
            </span><span class="s2">case </span><span class="s1">REQUEST_CONNECT_DEVICE_SECURE: 
                </span><span class="s5">// When DeviceListActivity returns with a device to connect</span><span class="s1"> 
                </span><span class="s2">if </span><span class="s1">(resultCode == Activity.RESULT_OK) { 
                    connectDevice(data</span><span class="s2">, true</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
                </span><span class="s2">break;</span><span class="s1"> 
            </span><span class="s2">case </span><span class="s1">REQUEST_CONNECT_DEVICE_INSECURE: 
                </span><span class="s5">// When DeviceListActivity returns with a device to connect</span><span class="s1"> 
                </span><span class="s2">if </span><span class="s1">(resultCode == Activity.RESULT_OK) { 
                    connectDevice(data</span><span class="s2">, false</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                } 
                </span><span class="s2">break;</span><span class="s1"> 
            </span><span class="s2">case </span><span class="s1">REQUEST_ENABLE_BT: 
                </span><span class="s5">// When the request to enable Bluetooth returns</span><span class="s1"> 
                </span><span class="s2">if </span><span class="s1">(resultCode == Activity.RESULT_OK) { 
                    </span><span class="s5">// Bluetooth is now enabled, so set up a chat session</span><span class="s1"> 
                    setupChat()</span><span class="s2">;</span><span class="s1"> 
                } </span><span class="s2">else </span><span class="s1">{ 
                    </span><span class="s5">// User did not enable Bluetooth or an error occurred</span><span class="s1"> 
                    Log.d(TAG</span><span class="s2">, </span><span class="s4">&quot;BT not enabled&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                    Toast.makeText(getActivity()</span><span class="s2">, </span><span class="s1">R.string.bt_not_enabled_leaving</span><span class="s2">,</span><span class="s1"> 
                            Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
                    getActivity().finish()</span><span class="s2">;</span><span class="s1"> 
                } 
        } 
    } 
 
    </span><span class="s3">/** 
     * Establish connection with other divice 
     * 
     * @param data   An {@link Intent} with {@link DeviceListActivity#EXTRA_DEVICE_ADDRESS} extra. 
     * @param secure Socket Security type - Secure (true) , Insecure (false) 
     */</span><span class="s1"> 
    </span><span class="s2">private void </span><span class="s1">connectDevice(Intent data</span><span class="s2">, boolean </span><span class="s1">secure) { 
        </span><span class="s5">// Get the device MAC address</span><span class="s1"> 
        String address = data.getExtras() 
                .getString(DeviceListActivity.EXTRA_DEVICE_ADDRESS)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s5">// Get the BluetoothDevice object</span><span class="s1"> 
        BluetoothDevice device = mBluetoothAdapter.getRemoteDevice(address)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s5">// Attempt to connect to the device</span><span class="s1"> 
        mChatService.connect(device</span><span class="s2">, </span><span class="s1">secure)</span><span class="s2">;</span><span class="s1"> 
    } 
 
    @Override 
    </span><span class="s2">public void </span><span class="s1">onCreateOptionsMenu(Menu menu</span><span class="s2">, </span><span class="s1">MenuInflater inflater) { 
        inflater.inflate(R.menu.bluetooth_chat</span><span class="s2">, </span><span class="s1">menu)</span><span class="s2">;</span><span class="s1"> 
    } 
 
    @Override 
    </span><span class="s2">public boolean </span><span class="s1">onOptionsItemSelected(MenuItem item) { 
        </span><span class="s2">switch </span><span class="s1">(item.getItemId()) { 
            </span><span class="s2">case </span><span class="s1">R.id.secure_connect_scan: { 
                </span><span class="s5">// Launch the DeviceListActivity to see devices and do scan</span><span class="s1"> 
                Intent serverIntent = </span><span class="s2">new </span><span class="s1">Intent(getActivity()</span><span class="s2">, </span><span class="s1">DeviceListActivity.</span><span class="s2">class</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                startActivityForResult(serverIntent</span><span class="s2">, </span><span class="s1">REQUEST_CONNECT_DEVICE_SECURE)</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">return true;</span><span class="s1"> 
            } 
            </span><span class="s2">case </span><span class="s1">R.id.insecure_connect_scan: { 
                </span><span class="s5">// Launch the DeviceListActivity to see devices and do scan</span><span class="s1"> 
                Intent serverIntent = </span><span class="s2">new </span><span class="s1">Intent(getActivity()</span><span class="s2">, </span><span class="s1">DeviceListActivity.</span><span class="s2">class</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
                startActivityForResult(serverIntent</span><span class="s2">, </span><span class="s1">REQUEST_CONNECT_DEVICE_INSECURE)</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">return true;</span><span class="s1"> 
            } 
            </span><span class="s2">case </span><span class="s1">R.id.discoverable: { 
                </span><span class="s5">// Ensure this device is discoverable by others</span><span class="s1"> 
                ensureDiscoverable()</span><span class="s2">;</span><span class="s1"> 
                </span><span class="s2">return true;</span><span class="s1"> 
            } 
        } 
        </span><span class="s2">return false;</span><span class="s1"> 
    } 
 
}</span></pre>
</body>
</html>